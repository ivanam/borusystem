{% extends "base_mozo.html" %}
{% block titulo %}Boru - Seleccionar Mesas{% endblock %}
{% block contenido %}

      <div class="contenedor_secundario">
        <div class="btn_anterior" id="btn_anterior" alt="Anterior"></div>
        <div class="btn_siguiente" id="btn_siguiente" alt="Siguiente"></div>
        <div id="con_menu_mozo" class="cont_redondeado contenedor_principal">
          <div class="label label-inverse titulo_menu">Seleccionar Menu</div>
          <br>
          <div class="salto_linea"></div>
          <div id="mesas_libres" class="bloque_mesas">
          <input type="hidden" class="contenedor_cantidad" name="id_comanda">
            {% for s in seccion %}
            <div id="cat_01" class="cat_item" rel="{{s.nombre|capfirst}}" id_seccion="{{s.id}}">
              <div class="img_cont"> <img src="{{STATIC_URL}}img/comida/{{s.imagen}}"> </div>
              <div class="label label-inverse">{{s.nombre}}</div>
            </div>
             {% endfor %}
          </div>
        </div>
      </div>
      <div class="salto_linea"></div>
      <!-- fin del contenido de la pagina -->
<!-- Modal -->
<div id="myModal" class="modal_seleccion_menu modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel" class="modal-titulo"></h3>
  </div>
  <div class="modal-body">

  </div>
  <div class="modal-footer">
    <button class="btn btn_aceptar" id="btn_aceptar" data-dismiss="modal" aria-hidden="true"id_prod="{{p.id}}">Aceptar</button>
    <button class="btn btn_cancelar" data-dismiss="modal" aria-hidden="true">Cerrar</button>
  </div>
</div>
<!-- Fin Modal -->
<!-- contenido de las modals //-->
<!-- fin conrenido de las modals //-->
{% endblock %}

{% block script %}

<script>
function guardar_producto(prod){

$.ajax({
        type: "GET",
        url: "{% url 'guardarproductosajax' %}",
        data: "id_prod="+prod,
        success: function(platos){
            $(".platos").html(platos);
        }
})

}
function cargar_panel(){

$.ajax({
        type: "GET",
        url: "{% url 'cargarpanelajax' %}",
        data: "id_prod=",
        success: function(platos){
            $(".platos").html(platos);
        }
})

}
function cargar_productos(id_seccion,nombre_seccion){

$.ajax({
                type: "GET",
                url: "{% url 'cargarproductosajax' %}",
                data: "id_seccion="+id_seccion,
                success: function(platos){

                    $('.modal-titulo').html("Seccion "+nombre_seccion);
                    $('.modal-body').html(platos);
                    $('#myModal').modal("show");


                    $(".btn_mas").each(function(i){

                     $(this).click(function(event){

                        var id_prod=$(this).attr('id_prod');


                    var incremento = parseInt($("#"+id_prod).val())+1;

                        //alert(incremento+"  "+$(this).attr('stock')+"   "+$("#"+id_prod).val());

                        if (incremento <= $(this).attr('stock'))
                            $("#"+id_prod).val(incremento);



                     });
               });
               $(".btn_menos").each(function(i){

                     $(this).click(function(event){

                        var id_prod=$(this).attr('id_prod');


                    var decremento = parseInt($("#"+id_prod).val())-1;

                        //alert(incremento+"  "+$(this).attr('stock')+"   "+$("#"+id_prod).val());

                        if (decremento >= 0)
                            $("#"+id_prod).val(decremento);



                     });
               });

               	$(".btn_aceptar").click(function(){
                    //var id_prod=$(this).attr('id_prod');
                    //alert(id_prod);
                    $(".tr_item_info").each(function(i){
                        var prod =$(this).attr("id_prod");
                        var nombre =$(this).attr("nombre");
                        var precio =$(this).attr("precio");
                        alert (precio);
                        var menues = $(".menu").html();
			            var cad = '<div class="badge badge-inverse menu_producto">'+nombre+'</div> <div class="badge badge-success">'+precio+'<br> </div>';
			            menues = menues + cad;
					    $(".menu").html(menues);})
                        //if ($("#"+id_prod).val()>0)
                        //guardar_producto(prod);})
                    //cargar_panel();
                });

                }
            });
}
$(document).ready(function(){
     
	$("#btn_anterior").click(function(){
		document.location.href = "{% url 'crearcomanda' %}";
	});	
	$("#btn_siguiente").click(function(){
		document.location.href = "{% url 'finalizar' %}";
	});


	
	//le asocio una funcion a cada miembro d ela clase cat_item
	$(".cat_item").each(function(i){
				 
		 $(this).click(function(event){
		    cargar_productos($(this).attr("id_seccion"),$(this).attr("rel"));
		 });
     });
	
	
	
});
</script>
{% endblock %}
